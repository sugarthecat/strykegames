// users: 
// discotechnical = fred
// cronk = james (reporter)
// treelover = olivia (vegan)
// australia_isnt_real = tom (crush)
// circuitbiter = cherry (non binary linux user)
// crunchy_kiwifruit = Vera (nonchalant)
// italiansadnwich = Jonas (annoying)
// gandoff = Tracy (not yet implemented)
// calc_u_later = [name] (computer nerd, doesnt know fred)
const skokalPosts = [
    {
        author: "cronk",
        content: "Any parties this weekend??",
        replies: [
            {
                author: "calc_u_later",
                content: "Nah. At least, none that I'm invited to.",
                replies: []
            }
        ]
    },
    {
        author: "australia_isnt_real",
        content: "Can the sun just, not today? I want to sleep in.",
        replies: [
            {
                author: "treelover",
                content: "REAL!!!!",
                replies: [
                    {
                        author: "australia_isnt_real",
                        content: "I'm just an illustrator boy, I just want to nap.",
                        replies: []
                    }
                ]
            }
        ]
    },
    {
        author: "treelover",
        content: "Can we please get some maple trees in Chraston Park?? nothing beats the smell of sap",
        replies: [
            {
                author: "treelover",
                content: "Imagine waking up and going to the park and it smells like pancakes. NEED.",
                replies: []
            },
            {
                author: "australia_isnt_real",
                content: "Olivia are you making sure this is your only post just to live up to your username? LOL",
                replies: [
                    {
                        author: "treelover",
                        content: "Not only that, I stole this post from you :).",
                        replies: []
                    }]
            },]
    },

    {
        author: "calc_u_later",
        content: "Trying to think of binary jokes, you guys know any good ones?",
        replies: [
            {
                author: "circuitbiter",
                content: "I do, you either get them or you don't.",
                replies: []
            },
            {
                author: "discotechnical",
                content: "01001110 01001111",
                replies: [
                    {
                        author: "circuitbiter",
                        content: "You can do better than that!",
                        replies: []
                    }]
            }
        ]
    },

    {
        author: "calc_u_later",
        content: "Best puzzle game ever, go:",
        replies: [
            {
                author: "cronk",
                content: "Wormhole, and it's not even close.",
                replies: []
            },
            {
                author: "crunchy_kiwifruit",
                content: "Inner Worlds is awesome, life changing stuff.",
                replies: [
                    {
                        author: "calc_u_later",
                        content: "This one wins",
                        replies: []
                    }]
            },
            {
                author: "treelover",
                content: "No clue, I only play Digbuild.",
                replies: []
            }]
    },
    {
        author: "treelover",
        content: "Vera is an Inner Worlds fan, confirmed!!!",
        replies: [
            {
                author: "crunchy_kiwifruit",
                content: "I'm not gonna hate on a good game just because you trashed it once.",
                replies: []
            }]
    },
    {
        author: "crunchy_kiwifruit",
        content: "Full Lord: Threadmelody is the best game of the year and it's not even close.",
        replies: [
            {
                author: "crunchy_kiwifruit",
                content: "Not only game of the year, it's the best game of all time.",
                replies: []
            },
            {
                author: "circuitbiter",
                content: "The original is better and it's not even close."
                    + " Wasp is a weak character, the abilities are so exploitable,"
                    + " the diagonal pogo is horrible, and the final boss? straight up dissapointing.",
                replies: [{
                    author: "australia_isnt_real",
                    content: "Splish splash your opinion is trash",
                    replies: []
                }]
            },
        ]
    },
    {
        author: "circuitbiter",
        content: "Anybody want RAM sticks? I have extra rn lol, didn't mean to win this auction.",
        replies: [
            {
                author: "crunchy_kiwifruit",
                content: "I could use one if you don't mind.",
                replies: []
            },
            {
                author: "treelover",
                content: "You should make a log cabin out of RAM sticks!",
                replies: []
            },
            {
                author: "calc_u_later",
                content: "In this economy? Yes please!!",
                replies: []
            },
            {
                author: "cronk",
                content: "Wouldn't expect anyone else to randomly have RAM sticks.",
                replies: []
            }
        ]
    },
    {
        author: "discotechnical",
        content: "Pretty beautiful morning today. The sun is sunning. The birds are birding. The clouds, the clouds? They're there.",
        replies: [
            {
                author: "treelover",
                content: "And the trees?",
                replies: [
                    {
                        author: "discotechnical",
                        content: "Completely gone.",
                        replies: [
                            {
                                author: "treelover",
                                content: "NOOOOOOOOOO",
                                replies: []
                            }]
                    }]
            },
            {
                author: "italiansadnwich",
                content: "A beautiful morning to finally fix your car's broken passenger door?",
                replies: [
                    {
                        author: "discotechnical",
                        content: "Hmmm... No.",
                        replies: []
                    },
                    {
                        author: "australia_isnt_real",
                        content: "Jonas, you don't even have a car.",
                        replies: []
                    }]
            }]
    },
    {
        author: "cronk",
        content: "So... who do you like??? (thread)",
        replies: [
            {
                author: "crunchy_kiwifruit",
                content: "I'm gonna be so real, nobody is gonna confess their crush in a Skokal thread.",
                replies: []
            },
            {
                author: "italiansadnwich",
                content: "I have a crush on people who aren't washed up & working as a (practically) coffee boy at the Chronicle, LOL.",
                replies: [
                    {
                        author: "cronk",
                        content: "That's not even fair, you unemployed do-nothing.",
                        replies: []
                    }]
            }]
    },
    {
        author: "italiansadnwich",
        content: "NO, I did NOT mispell SANDWICH in my USERNAME! It is \"Sad\" n' \"Witch\"!!",
        replies: [
            {
                author: "australia_isnt_real",
                content: "Yeah, you mispelled it.",
                replies: [
                    {
                        author: "italiansadnwich",
                        content: "Thomas Sanders, you called Doctor Seuss \"Dur Sues\" for like, 5 years.",
                        replies: [
                            {
                                author: "australia_isnt_real",
                                content: "And you misspelled your name when applying to the competitive writing team???",
                                replies: [
                                    {
                                        author: "italiansadnwich",
                                        content: "Did Dur Sues tell you that?",
                                        replies: []
                                    },]
                            },]
                    },]
            },]
    },
    {
        author: "italiansadnwich",
        content: "I love trains. They're so CHOO CHOO!",
        replies: [
            {
                author: "calc_u_later",
                content: "I love my rustbucket truck more than any train.",
                replies: []
            }
        ]
    },
    {
        author: "circuitbiter",
        content: "mm... Tasty GPUs...",
        replies: [
            {
                author: "treelover",
                content: "GPUs aren't food! Especially not for growing young gamers.",
                replies: [
                    {
                        author: "circuitbiter",
                        content: "This is why I love you. Still gonna Gnaw on GPUs.",
                        replies: [
                            {
                                author: "treelover",
                                content: "I love you too. Still not installing Linux.",
                                replies: []
                            },]
                    },]
            },]
    },
    {
        author: "crunchy_kiwifruit",
        content: "What I would do for a ham sandwich would make the news.",
        replies: [
            {
                author: "cronk",
                content: "I mean, I'm a reporter. As long as I get the first scoop.",
                replies: []
            }]
    },
    {
        author: "australia_isnt_real",
        content: "I feel like there aren't enough trees in Chraston park. It's just like a lot filled with grass.",
        replies: [
            {
                author: "treelover",
                content: "Gonna steal this later :)",
                replies: []
            }]
    },
    {
        author: "crunchy_kiwifruit",
        content: "Any book recommendations?",
        replies: [
            {
                author: "discotechnical",
                content: "Put \"Kurt Vonnegut\" into the search engine of your choice, he has some really good stuff.",
                replies: [
                    {
                        author: "crunchy_kiwifruit",
                        content: "tysm! will do.",
                        replies: [
                            {
                                author: "discotechnical",
                                content: "No problem! Always happy to plug my favorite author.",
                                replies: []
                            }]
                    },
                    {
                        author: "australia_isnt_real",
                        content: "How about you put \"yourself\" into the \"my arms\" of your choice?",
                        replies: [
                            {
                                author: "discotechnical",
                                content: "Smooth, I'll see you tonight, dear.",
                                replies: []
                            },
                            {
                                author: "crunchy_kiwifruit",
                                content: "You two are cute together but surely you have a better place to flirt than Skokal comments sections.",
                                replies: [
                                    {
                                        author: "australia_isnt_real",
                                        content: "Romance is a lost art and I'm bringing it back.",
                                        replies: []
                                    }]
                            }]
                    }]
            }]
    },
    {
        author: "crunchy_kiwifruit",
        content: "I feel like I could start a band. I don't play any instruments but I have the spirit down.",
        replies: []
    },
    {
        author: "discotechnical",
        content: "I <3 my artist boy.",
        replies: []
    },
    {
        author: "treelover",
        content: "Sometimes I feel like a herbivore",
        replies: [
            {
                author: "treelover",
                content: "Like, I fill my sandwich with so much arugula it's equal parts bread and arugula.",
                replies: [
                    {
                        author: "italiansadnwich",
                        content: "You're secretly a bunny or perhaps a chicken?",
                        replies: [
                            {
                                author: "treelover",
                                content: "Perhaps",
                                replies: []
                            }]
                    }]
            }
        ]
    },
    {
        author: "treelover",
        content: "Would you guys beleive me if I said I wasn't vegetarian?",
        replies: [
            {
                author: "circuitbiter",
                content: "No. Eating raw garlic just makes you weird, not a carnivore.",
                replies: []
            },
            {
                author: "australia_isnt_real",
                content: "Yes! Eating raw garlic makes you a cavewoman carnivore.",
                replies: [
                    {
                        author: "circuitbiter",
                        content: "Tom, you need to ston enabling her.",
                        replies: []
                    }]
            }
        ]
    },
    {
        author: "discotechnical",
        content: "I've been working on my writing, check this out! Title: \"Skokie's Seven Sides\"",
        replies: [
            {
                author: "discotechnical",
                content: "Side one is some single family suburban slump. Side two is indie bands, beers, baroque, and backstreet bashes.",
                replies: []
            },
            {
                author: "discotechnical",
                content: "Side three is a depreciating derelict dump. Side four is fighting for freedom of faith.",
                replies: []
            },
            {
                author: "discotechnical",
                content: "Side five is ignoring ignorance. Side six is a collection of commoners completing and co-operating to change course.  ",
                replies: []
            },
            {
                author: "discotechnical",
                content: "Side Seven is humble hope that their home happens to teach your youth beachside beauty, long-term love, such so our one wonderful world mission might, one ordinary day, hopefully happen.",
                replies: []
            },
            {
                author: "italiansadnwich",
                content: "K for Killing it!",
                replies: []
            },
            {
                author: "crunchy_kiwifruit",
                content: "Love it!",
                replies: []
            },
            {
                author: "cronk",
                content: "Can I publish this?",
                replies: [
                    {
                        author: "discotechnical",
                        content: "I'd love that!",
                        replies: []
                    },]
            }
        ]
    },
    {
        author: "circuitbiter",
        content: "Anybody play the new City of Gods game?",
        replies: [
            {
                author: "crunchy_kiwifruit",
                content: "OMG I love that game.",
                replies: []
            },]
    },
    {
        author: "circuitbiter",
        content: "Still not sure why I gave myself this username. Put your guesses below",
        replies: [
            {
                author: "discotechnical",
                content: "Because you're an absolute computer geek?",
                replies: [
                    {
                        author: "treelover",
                        content: "Think deeper...",
                        replies: []
                    },]
            },
            {
                author: "australia_isnt_real",
                content: "Something something about silicon based life?",
                replies: [
                    {
                        author: "treelover",
                        content: "NOPE!!!",
                        replies: []
                    },]
            },
            {
                author: "treelover",
                content: "Because you're a computer nerd AND wanted to make a joke about destroying binaries?",
                replies: [
                    {
                        author: "circuitbiter",
                        content: "Yeah :3",
                        replies: []
                    },]
            },]
    },
]
let currForumPage = 'home'
let forumbody = null;
function initForum() {
    forumbody = document.createElement('div')
    const webpage = document.getElementById("webpage");
    const topSection = document.createElement('div')
    topSection.innerHTML = "<h1>Skokal</h1><p><b>Skokie's best local chatroom</b></p>"
    topSection.onclick = function () {
        currForumPage = "home";
        updateForum()
    }
    const links = document.createElement('div')
    links.className = "links"

    const rule1 = document.createElement('hr')
    topSection.appendChild(rule1)

    webpage.appendChild(topSection)
    webpage.appendChild(forumbody)
    updateForum()
}

function countReplies(post) {
    console.log(post)
    let n = post.replies.length;
    for (let i = 0; i < post.replies.length; i++) {
        n += countReplies(post.replies[i])
    }
    return n
}

function makePostStub(postid) {
    const post = skokalPosts[postid];
    const stub = document.createElement('div')
    stub.className = "postStub"
    const username = document.createElement('h3')
    username.innerText = post.author;
    const content = document.createElement('p')
    content.innerText = post.content;
    const commentCounter = document.createElement('p')
    let commentCount = countReplies(post)
    commentCounter.innerText = `${commentCount} Repl${commentCount === 1 ? "y" : "ies"}`;
    commentCounter.className = "commentcount"
    stub.appendChild(username)
    stub.appendChild(content)
    stub.appendChild(commentCounter)
    stub.className = "poststub"
    stub.onclick = function () {
        currForumPage = `post/${postid}`
        updateForum()
    }
    return stub
}

function makePostBody(post) {
    const element = document.createElement('div')
    element.className = 'post'
    const username = document.createElement('h2');
    username.innerHTML = `<a page=\"profile/${post.author}\">${post.author}</a>`;
    const content = document.createElement('p');
    content.innerText = post.content;
    element.appendChild(username)
    element.appendChild(content)

    const replies = document.createElement('h3')
    replies.innerText = "Replies: "
    const replydiv = document.createElement('div')
    if (post.replies.length > 0) {
        element.appendChild(replies)
        for (let i = 0; i < post.replies.length; i++) {
            let reply = makeReplyBody(post.replies[i])
            replydiv.appendChild(reply)
        }
    }
    element.appendChild(replydiv)
    return element
}
function makeReplyBody(post) {
    const element = document.createElement('div')
    element.className = 'reply'
    const username = document.createElement('h3');
    username.innerHTML = `<a page=\"profile/${post.author}\">${post.author}</a>`;
    const content = document.createElement('p');
    content.innerText = post.content;
    element.appendChild(username)
    element.appendChild(content)

    const replydiv = document.createElement('div')
    if (post.replies.length > 0) {
        for (let i = 0; i < post.replies.length; i++) {
            let reply = makeReplyBody(post.replies[i])
            replydiv.appendChild(reply)
        }
    }
    element.appendChild(replydiv)
    return element
}

function updateForum() {
    forumbody.innerHTML = ""
    const parts = currForumPage.split("/")
    if (parts[0] == 'home') {
        forumbody.innerHTML = "<h2>New Posts</h2>";
        const postsContainer = document.createElement("div")
        for (let i = 0; i < 3; i++) {
            const stub = makePostStub(i);
            postsContainer.appendChild(stub)
        }
        forumbody.appendChild(postsContainer)
    } else if (parts[0] == 'profile') {
        forumbody.innerHTML = `<h2>${parts[1]}'s Posts</h2>`;
        const postsContainer = document.createElement("div")
        for (let i = 0; i < skokalPosts.length; i++) {
            if (skokalPosts[i].author !== parts[1]) {
                continue;
            }
            const stub = makePostStub(i);
            postsContainer.appendChild(stub)
        }
        forumbody.appendChild(postsContainer)
    } else if (parts[0] == 'post') {
        const post = skokalPosts[parseInt(parts[1])];
        let postbody = makePostBody(post)
        forumbody.appendChild(postbody)
    }
    let toSearch = []
    for (let i = 0; i < forumbody.children.length; i++) {
        toSearch.push(forumbody.children[i])
    }

    while (toSearch.length > 0) {
        let currItem = toSearch.pop()
        for (let i = 0; i < currItem.children.length; i++) {
            toSearch.push(currItem.children[i])
        }
        if (currItem.getAttribute('page') !== null) {
            const page = currItem.getAttribute('page')
            currItem.onclick = function () {
                currForumPage = page;
                updateForum();
            }
        }
    }
}