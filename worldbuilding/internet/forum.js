// users: 
// discotechnical = fred
// carvparts = james
// treelover = olivia
// australia_isnt_real = crush ( tom )
// circuitbiter = cherry (non binary)
// crunchy_kiwifruit = some guy LOL
// italiansadnwich = some guy LOL
const skokalPosts = [
    {
        author: "carvparts",
        content: "Any parties this weekend??",
        replies: [
            {
                author: "discotechnical",
                content: "Nah, but I'd be down to hang out today if you want.",
                replies: [
                    {
                        author: "carvparts",
                        content: "Text me!",
                        replies: []
                    }]
            }]
    },
    {
        author: "australia_isnt_real",
        content: "Can the sun just, not today? I want to sleep in.",
        replies: [
            {
                author: "circuitbiter",
                content: "REAL!!!!",
                replies: [
                    {
                        author: "australia_isnt_real",
                        content: "I'm just an illustrator boy, I just want to nap.",
                        replies: []
                    }
                ]
            }
        ]
    },
    {
        author: "treelover",
        content: "Can we please get some maple trees in Chraston Park?? nothing beats the smell of sap",
        replies: [
            {
                author: "treelover",
                content: "Imagine waking up and going to the park and it smells like pancakes. NEED.",
                replies: []
            },
            {
                author: "australia_isnt_real",
                content: "Olivia are you making sure this is your only post just to live up to your username? LOL",
                replies: [
                    {
                        author: "treelover",
                        content: "Not only that, I stole this post from you :).",
                        replies: []
                    }]
            },]
    },
    {
        author: "circuitbiter",
        content: "Anybody want RAM sticks? I have extra rn lol, didn't mean to win this auction.",
        replies: [
            {
                author: "treelover",
                content: "I could use one if you don't mind.",
                replies: []
            },
            {
                author: "carvparts",
                content: "Wouldn't expect anyone else to randomly have RAM sticks.",
                replies: []
            }
        ]
    },
    {
        author: "discotechnical",
        content: "Pretty beautiful morning today. The sun is sunning. The birds are birding. The clouds, the clouds? They're there.",
        replies: [
            {
                author: "treelover",
                content: "And the trees?",
                replies: [
                    {
                        author: "discotechnical",
                        content: "Completely gone.",
                        replies: [
                            {
                                author: "treelover",
                                content: "NOOOOOOOOOO",
                                replies: []
                            }]
                    }]
            },
            {
                author: "italiansadnwich",
                content: "A beautiful morning to finally fix your car's broken door?",
                replies: [
                    {
                        author: "discotechnical",
                        content: "Hmmm... No.",
                        replies: []
                    }]
            }]
    },
    {
        author: "carvparts",
        content: "So... who do you like??? (thread)",
        replies: [
            {
                author: "crunchy_kiwifruit",
                content: "I'm gonna be so real, nobody is gonna confess their crush in a Skokal thread.",
                replies: []
            },
            {
                author: "italiansadnwich",
                content: "I have a crush on people who aren't washed up & working as a coffee boy at the Chronicle, LOL.",
                replies: [
                    {
                        author: "carvparts",
                        content: "I'm gonna get the next big story trust me!!",
                        replies: []
                    }]
            }]
    },
    {
        author: "italiansadnwich",
        content: "NO, I did NOT mispell SANDWICH in my USERNAME! It is \"Sad\" n' \"Witch\"!!",
        replies: [
            {
                author: "australia_isnt_real",
                content: "Yeah, you mispelled it.",
                replies: [
                    {
                        author: "italiansadnwich",
                        content: "Thomas Sanders, you called Doctor Seuss \"Dur Sues\" for like, 5 years.",
                        replies: [
                            {
                                author: "australia_isnt_real",
                                content: "And you misspelled your name when applying to the competitive writing team???",
                                replies: [
                                    {
                                        author: "italiansadnwich",
                                        content: "Did Dur Sues tell you that?",
                                        replies: []
                                    },]
                            },]
                    },]
            },]
    },
    {
        author: "italiansadnwich",
        content: "I love cars. They're so VROOM!",
        replies: [
            {
                author: "circuitbiter",
                content: "I love my rustbucket truck",
                replies: []
            }
        ]
    },
    {
        author: "circuitbiter",
        content: "mm... Tasty GPUs...",
        replies: [
            {
                author: "treelover",
                content: "GPUs aren't food! Especially not for growing young gamers.",
                replies: [
                    {
                        author: "circuitbiter",
                        content: "This is why I love you. Still gonna Gnaw on GPUs.",
                        replies: [
                            {
                                author: "treelover",
                                content: "I love you too. Still not installing Linux.",
                                replies: []
                            },]
                    },]
            },]
    },
    {
        author: "crunchy_kiwifruit",
        content: "What I would do for a ham sandwich would make the news.",
        replies: [
            {
                author: "carvparts",
                content: "I mean, I'm a reporter. As long as I get the first scoop.",
                replies: []
            }]
    },
    {
        author: "australia_isnt_real",
        content: "I feel like there aren't enough trees in Chraston park. It's just like a lot filled with grass.",
        replies: [
            {
                author: "treelover",
                content: "Gonna steal this later :)",
                replies: []
            }]
    },
    {
        author: "crunchy_kiwifruit",
        content: "Any book reccomendations?",
        replies: [
            {
                author: "discotechnical",
                content: "Put \"Kurt Vonnegut\" into the search engine of your choice, he has some really good stuff.",
                replies: [
                    {
                        author: "crunchy_kiwifruit",
                        content: "tysm! will do.",
                        replies: [
                            {
                                author: "discotechnical",
                                content: "No problem! Always happy to plug my favorite author.",
                                replies: []
                            }]
                    },
                    {
                        author: "australia_isnt_real",
                        content: "How about you put \"yourself\" into the \"my arms\" of your choice?",
                        replies: [
                            {
                                author: "discotechnical",
                                content: "Smooth, I'll see you tonight, dear.",
                                replies: []
                            },
                            {
                                author: "crunchy_kiwifruit",
                                content: "You two are cute together but surely you have a better place to flirt than Skokal comments sections.",
                                replies: [
                                    {
                                        author: "australia_isnt_real",
                                        content: "Romance is a lost art and I'm bringing it back.",
                                        replies: []
                                    }]
                            }]
                    }]
            }]
    },
    {
        author: "crunchy_kiwifruit",
        content: "I feel like I could start a band. I don't play any instruments but I have the spirit down.",
        replies: []
    },
    {
        author: "discotechnical",
        content: "I <3 my artist boy.",
        replies: []
    },
    {
        author: "treelover",
        content: "Sometimes I feel like a herbivore",
        replies: [
            {
                author: "treelover",
                content: "Like, I fill my sandwich with so much arugula it's equal parts bread and arugula.",
                replies: [
                    {
                        author: "italiansadnwich",
                        content: "You're secretly a bunny or perhaps a chicken?",
                        replies: [
                            {
                                author: "treelover",
                                content: "Perhaps",
                                replies: []
                            }]
                    }]
            }
        ]
    },
    {
        author: "treelover",
        content: "Would you guys beleive me if I said I wasn't vegetarian?",
        replies: [
            {
                author: "circuitbiter",
                content: "No. Eating raw garlic just makes you weird, not a carnivore.",
                replies: []
            },
            {
                author: "australia_isnt_real",
                content: "Yes! Eating raw garlic makes you a cavewoman carnivore.",
                replies: [
                    {
                        author: "circuitbiter",
                        content: "Tom, you need to ston enabling her.",
                        replies: []
                    }]
            }
        ]
    },
    {
        author: "discotechnical",
        content: "I've been working on my writing, check this out! Title: \"Skokie's Seven Sides\"",
        replies: [
            {
                author: "discotechnical",
                content: "Side one is some single family suburban slump. Side two is indie bands, beers, baroque, and backstreet bashes.",
                replies: []
            },
            {
                author: "discotechnical",
                content: "Side three is a depreciating derelict dump. Side four is fighting for freedom of faith.",
                replies: []
            },
            {
                author: "discotechnical",
                content: "Side five is ignoring ignorance. Side six is a collection of commoners completing and co-operating to change course.  ",
                replies: []
            },
            {
                author: "discotechnical",
                content: "Side Seven is humble hope that their home happens to teach your youth beachside beauty, long-term love, such so our one wonderful world mission might, one ordinary day, hopefully happen.",
                replies: []
            },
            {
                author: "italiansadnwich",
                content: "Good job!",
                replies: []
            },
            {
                author: "carvparts",
                content: "Can I publish this?",
                replies: [
                    {
                        author: "discotechnical",
                        content: "I'd love that!",
                        replies: []
                    },]
            }
        ]
    },
    {
        author: "circuitbiter",
        content: "Anybody play the new City of Gods game?",
        replies: [
            {
                author: "crunchy_kiwifruit",
                content: "OMG I love that game.",
                replies: []
            },]
    },
    {
        author: "circuitbiter",
        content: "Still not sure why I gave myself this username. Put your guesses below",
        replies: [
            {
                author: "discotechnical",
                content: "Because you're an absolute computer geek?",
                replies: [
                    {
                        author: "treelover",
                        content: "Think deeper...",
                        replies: []
                    },]
            },
            {
                author: "australia_isnt_real",
                content: "Something something about silicon based life?",
                replies: [
                    {
                        author: "treelover",
                        content: "NOPE!!!",
                        replies: []
                    },]
            },
            {
                author: "treelover",
                content: "Because you're a computer nerd AND wanted to make a joke about destroying binaries?",
                replies: [
                    {
                        author: "circuitbiter",
                        content: "Yeah :3",
                        replies: []
                    },]
            },]
    },
]
let currForumPage = 'home'
let forumbody = null;
function initForum() {
    forumbody = document.createElement('div')
    const webpage = document.getElementById("webpage");
    const topSection = document.createElement('div')
    topSection.innerHTML = "<h1>Skokal</h1><p><b>Skokie's best local chatroom</b></p>"
    topSection.onclick = function () {
        currForumPage = "home";
        updateForum()
    }
    const links = document.createElement('div')
    links.className = "links"

    const rule1 = document.createElement('hr')
    topSection.appendChild(rule1)

    webpage.appendChild(topSection)
    webpage.appendChild(forumbody)
    updateForum()
}

function countReplies(post) {
    let n = post.replies.length;
    for (let i = 0; i < post.replies.length; i++) {
        n += countReplies(post.replies[i])
    }
    return n
}

function makePostStub(postid) {
    const post = skokalPosts[postid];
    const stub = document.createElement('div')
    stub.className = "postStub"
    const username = document.createElement('h3')
    username.innerText = post.author;
    const content = document.createElement('p')
    content.innerText = post.content;
    const commentCounter = document.createElement('p')
    let commentCount = countReplies(post)
    commentCounter.innerText = `${commentCount} Repl${commentCount === 1 ? "y" : "ies"}`;
    commentCounter.className = "commentcount"
    stub.appendChild(username)
    stub.appendChild(content)
    stub.appendChild(commentCounter)
    stub.className = "poststub"
    stub.onclick = function () {
        currForumPage = `post/${postid}`
        updateForum()
    }
    return stub
}

function makePostBody(post) {
    const element = document.createElement('div')
    element.className = 'post'
    const username = document.createElement('h2');
    username.innerHTML = `<a page=\"profile/${post.author}\">${post.author}</a>`;
    const content = document.createElement('p');
    content.innerText = post.content;
    element.appendChild(username)
    element.appendChild(content)

    const replies = document.createElement('h3')
    replies.innerText = "Replies: "
    const replydiv = document.createElement('div')
    if (post.replies.length > 0) {
        element.appendChild(replies)
        for (let i = 0; i < post.replies.length; i++) {
            let reply = makeReplyBody(post.replies[i])
            replydiv.appendChild(reply)
        }
    }
    element.appendChild(replydiv)
    return element
}
function makeReplyBody(post) {
    const element = document.createElement('div')
    element.className = 'reply'
    const username = document.createElement('h3');
    username.innerHTML = `<a page=\"profile/${post.author}\">${post.author}</a>`;
    const content = document.createElement('p');
    content.innerText = post.content;
    element.appendChild(username)
    element.appendChild(content)

    const replydiv = document.createElement('div')
    if (post.replies.length > 0) {
        for (let i = 0; i < post.replies.length; i++) {
            let reply = makeReplyBody(post.replies[i])
            replydiv.appendChild(reply)
        }
    }
    element.appendChild(replydiv)
    return element
}

function updateForum() {
    forumbody.innerHTML = ""
    const parts = currForumPage.split("/")
    if (parts[0] == 'home') {
        forumbody.innerHTML = "<h2>New Posts</h2>";
        const postsContainer = document.createElement("div")
        for (let i = 0; i < 3; i++) {
            const stub = makePostStub(i);
            postsContainer.appendChild(stub)
        }
        forumbody.appendChild(postsContainer)
    } else if (parts[0] == 'profile') {
        forumbody.innerHTML = `<h2>${parts[1]}'s Posts</h2>`;
        const postsContainer = document.createElement("div")
        for (let i = 0; i < skokalPosts.length; i++) {
            if (skokalPosts[i].author !== parts[1]) {
                continue;
            }
            const stub = makePostStub(i);
            postsContainer.appendChild(stub)
        }
        forumbody.appendChild(postsContainer)
    } else if (parts[0] == 'post') {
        const post = skokalPosts[parseInt(parts[1])];
        let postbody = makePostBody(post)
        forumbody.appendChild(postbody)
    }
    let toSearch = []
    for (let i = 0; i < forumbody.children.length; i++) {
        toSearch.push(forumbody.children[i])
    }

    while (toSearch.length > 0) {
        let currItem = toSearch.pop()
        for (let i = 0; i < currItem.children.length; i++) {
            toSearch.push(currItem.children[i])
        }
        if (currItem.getAttribute('page') !== null) {
            const page = currItem.getAttribute('page')
            currItem.onclick = function () {
                currForumPage = page;
                updateForum();
            }
        }
    }
}